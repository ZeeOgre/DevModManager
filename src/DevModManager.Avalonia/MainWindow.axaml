<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        xmlns:vm="clr-namespace:DevModManager.Core.ViewModels;assembly=DevModManager.Core"
        x:Class="DevModManager.Avalonia.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Width="1200"
        Height="480"
        d:DesignWidth="1200"
        d:DesignHeight="480"
        Padding="8"
        Title="DevModManager">

  <!-- Rows: Titlebar, Active Game Folder (centered), Button row, Content, Bottom bar -->
  <Grid RowDefinitions="Auto,Auto,Auto,*,Auto" ColumnDefinitions="*">

    <!-- DISTINCTIVE TITLEBAR -->
    <Border Grid.Row="0" Background="#2B2F3A" Padding="12" CornerRadius="6">
      <TextBlock Text="{Binding AppTitle}"
                 Foreground="White"
                 FontSize="16"
                 FontWeight="Bold"
                 VerticalAlignment="Center" />
    </Border>

    <!-- ACTIVE GAME FOLDER (centered) -->
    <Border Grid.Row="1" Padding="6" Margin="0,8,0,0">
      <Grid ColumnDefinitions="*,Auto,*">
        <TextBlock Grid.Column="1" Text="Active Game Folder" VerticalAlignment="Center" Margin="0,0,6,0" HorizontalAlignment="Center"/>
        <ComboBox Grid.Column="1" Width="420" Name="ActiveGameFolderComboBox" ItemsSource="{Binding GameFolders}" SelectedItem="{Binding SelectedGameFolder, Mode=TwoWay}" HorizontalAlignment="Center" Margin="120,18,120,0"/>
      </Grid>
    </Border>

    <!-- BUTTON ROW (all primary buttons moved here; CK/xEdit are kept in bottom tools) -->
    <Border Grid.Row="2" Padding="6" Margin="0,8,0,8">
      <Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
        <!-- Left-aligned actions -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
          <Button Content="Open Game Data" Command="{Binding OpenGameDataCommand}" />
          <!-- add more left-side actions here later -->
        </StackPanel>

        <!-- center intentionally left empty so active folder remains visually centered above -->

        <!-- Right-aligned quick actions (kept minimal here; Edit Plugins + Launch LOM moved to bottom) -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
          <!-- top section keeps only lightweight quick actions; Edit Plugins + Launch LOM moved to bottom tools -->
        </StackPanel>
      </Grid>
    </Border>

    <!-- MAIN GRID / ItemsControl -->
    <Border Grid.Row="3" BorderBrush="#404040" BorderThickness="1" Padding="6">
      <Grid RowDefinitions="Auto,Auto,*">

        <!-- Column headers: adjusted widths -->
        <Grid Grid.Row="0" ColumnDefinitions="*,140,260,80,80" Margin="0,0,0,8">
          <TextBlock Grid.Column="0" Text="Mod Name" FontWeight="Bold" />
          <TextBlock Grid.Column="1" Text="Current Stage" FontWeight="Bold" HorizontalAlignment="Center"/>
          <TextBlock Grid.Column="2" Text="Bethesda ID" FontWeight="Bold" HorizontalAlignment="Center"/>
          <TextBlock Grid.Column="3" Text="Nexus ID" FontWeight="Bold" HorizontalAlignment="Center"/>
          <TextBlock Grid.Column="4" Text="Monitor" FontWeight="Bold" HorizontalAlignment="Center"/>
        </Grid>

        <Rectangle Grid.Row="1" Height="1" Fill="#c0c0c0" />

        <ItemsControl Grid.Row="2" ItemsSource="{Binding Mods}">
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:ModItemViewModel">
              <Border BorderBrush="#c8c8c8" BorderThickness="1" Padding="8" Margin="0,0,0,4">
                <Border.ContextMenu>
                  <ContextMenu>
                    <MenuItem Header="Open Backup Folder" Command="{Binding OpenBackupCommand}" />
                    <MenuItem Header="Promote" Command="{Binding PromoteCommand}" />
                    <MenuItem Header="Package" Command="{Binding PackageCommand}" />
                  </ContextMenu>
                </Border.ContextMenu>

                <Grid ColumnDefinitions="*,140,260,80,80" VerticalAlignment="Center">
                  <Button Grid.Column="0"
                          Content="{Binding Name}"
                          Command="{Binding OpenFolderCommand}"
                          Background="Transparent"
                          BorderBrush="Transparent"
                          Foreground="#4FA3FF"
                          Padding="0"
                          HorizontalAlignment="Left" />

                  <ComboBox Grid.Column="1"
                            Width="120"
                            SelectedItem="{Binding Stage, Mode=TwoWay}">
                    <ComboBoxItem>DEV</ComboBoxItem>
                    <ComboBoxItem>TEST</ComboBoxItem>
                    <ComboBoxItem>STAGING</ComboBoxItem>
                    <ComboBoxItem>PROD</ComboBoxItem>
                  </ComboBox>

                  <!-- Bethesda is GUID (wide), Nexus narrow numeric or text -->
                  <TextBlock Grid.Column="2" Text="{Binding BethesdaId}" Foreground="#4FA3FF" TextDecorations="Underline" HorizontalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                  <TextBlock Grid.Column="3" Text="{Binding NexusId}" Foreground="#4FA3FF" TextDecorations="Underline" HorizontalAlignment="Center"/>
                  <RadioButton Grid.Column="4" IsChecked="{Binding IsMonitored, Mode=TwoWay}" GroupName="MonitorGroup" HorizontalAlignment="Center" />
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </Grid>
    </Border>

    <!-- BOTTOM BAR: tools and CK/xEdit. Move Edit Plugins + Launch LOM here (right). -->
    <Border Grid.Row="4" Padding="6" Margin="0,8,0,0">
      <Grid ColumnDefinitions="Auto,8,Auto,12,Auto,*,Auto,Auto">
        <TextBlock Grid.Column="0" Text="Tools:" VerticalAlignment="Center" />
        <Button Grid.Column="2" Content="Open GitHub" Command="{Binding OpenModDetailsCommand}" />

        <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="8">
          <Button Content="Launch CK ▾" />
          <Button Content="Launch xEdit ▾" />
        </StackPanel>

        <StackPanel Grid.Column="6" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
          <Button Content="Edit Plugins" Command="{Binding EditPluginsCommand}" />
          <Button Content="Launch LOM" Command="{Binding LaunchLomCommand}" />
        </StackPanel>

        <Button Grid.Column="7" Content="Launch Game" Command="{Binding LaunchGameCommand}" HorizontalAlignment="Right" />
      </Grid>
    </Border>

  </Grid>
</Window>   